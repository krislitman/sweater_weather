version: 2.1
orbs:
  ruby: circleci/ruby@0.1.2 

jobs:
  build:
    docker:
      - image: circleci/ruby:2.5.3-stretch-node
        environment:
          PGHOST: localhost
          PGUSER: sweater_weather
          RAILS_ENV: test
          REDIS_URL: redis://redis@localhost:6379
      - image: circleci/postgres:13
        environment:
          POSTGRES_USER: sweater_weather
          POSTGRES_DB: sweater_weather_test
          POSTGRES_PASSWORD: POSTGRES_HOST_AUTH_METHOD=trust

    executor: ruby/default
    steps:
      - checkout

      # Setup the environment
      - run: gem install bundler:2.2.15

      - run: bundle config set --local path 'turing/mod3/projects/sweater_weather'

      - run: bundle install ["path", "turing/mod3/projects/sweater_weather"]

      # Run the test suite
      - run: bundle exec rake